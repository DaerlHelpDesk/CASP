<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CASP Farmer & Household Profile</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #2b5b84;
  --primary-dark: #1e4464;
  --primary-light: #3a6fa5;
  --secondary: #4caf50;
  --danger: #e81123;
  --danger-dark: #a80000;
  --light: #f5f8fb;
  --white: #ffffff;
  --gray: #6c757d;
  --border-radius: 12px;
  --shadow: 0 4px 12px rgba(0,0,0,0.1);
  --transition: all 0.3s ease;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', system-ui, -apple-system, sans-serif; background-color: var(--light); color:#333; line-height:1.6; }
/* Navigation Header */
.nav-header { background-color: var(--primary); color:white; padding:15px 0; box-shadow:0 2px 10px rgba(0,0,0,0.1); position:sticky; top:0; z-index:100; }
.nav-container { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:0 20px; }
.nav-logo { display:flex; align-items:center; gap:15px; }
.nav-logo img { height:50px; }
.nav-logo h1 { font-size:1.5rem; font-weight:600; }
.nav-buttons { display:flex; gap:15px; }
.nav-btn { background-color:rgba(255,255,255,0.2); color:white; border:none; border-radius:6px; padding:10px 20px; cursor:pointer; transition: var(--transition); display:flex; align-items:center; gap:8px; font-weight:500; }
.nav-btn:hover { background-color:rgba(255,255,255,0.3); transform:translateY(-2px); }
.nav-btn i { font-size:1.1rem; }
/* Main Content */
.container { max-width:900px; margin:30px auto; padding:0 20px; }
.header { display:flex; align-items:center; justify-content:center; margin-bottom:30px; padding:20px; background: var(--white); border-radius: var(--border-radius); box-shadow: var(--shadow); }
.header img { height:80px; margin-right:15px; }
.header h2 { color: var(--primary); font-size:1.8rem; font-weight:600; }
.form-container { background: var(--white); border-radius: var(--border-radius); box-shadow: var(--shadow); padding:30px; margin-bottom:30px; }
fieldset { margin-bottom:25px; padding:20px; border:1px solid #e0e0e0; border-radius: var(--border-radius); position:relative; }
legend { font-weight:600; color: var(--primary); font-size:1.2rem; padding:0 10px; background: var(--white); border-radius:6px; }
.form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
.form-group { margin-bottom:20px; }
label { display:block; font-weight:500; margin-bottom:8px; color:#444; }
.required::after { content:" *"; color: var(--danger); }
input, select, textarea { width:100%; padding:12px 15px; border-radius:8px; border:1px solid #ddd; font-size:16px; transition: var(--transition); background-color: var(--white); }
input:focus, select:focus, textarea:focus { border-color: var(--primary); outline:none; box-shadow:0 0 0 3px rgba(43,91,132,0.2); }
.input-icon { position:relative; }
.input-icon i { position:absolute; left:15px; top:50%; transform:translateY(-50%); color: var(--gray); }
.input-icon input { padding-left:45px; }
.profile-pic-container { text-align:center; margin:20px 0; }
.profile-pic { width:150px; height:150px; border-radius:50%; border:3px solid var(--primary); object-fit:cover; display:none; margin:0 auto 15px; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
.photo-actions { display:flex; flex-direction:column; align-items:center; gap:10px; }
.file-input-wrapper { position:relative; overflow:hidden; display:inline-block; width:100%; max-width:300px; }
.file-input-wrapper input[type=file] { position:absolute; left:0; top:0; opacity:0; width:100%; height:100%; cursor:pointer; }
.file-input-button { display:flex; align-items:center; justify-content:center; gap:8px; background-color: var(--primary); color:white; padding:12px 20px; border-radius:8px; cursor:pointer; transition: var(--transition); width:100%; font-weight:500; }
.file-input-button:hover { background-color: var(--primary-dark); }
.btn-remove { background-color: var(--danger); color:white; border:none; border-radius:8px; padding:10px 20px; cursor:pointer; transition: var(--transition); display:flex; align-items:center; gap:8px; font-weight:500; }
.btn-remove:hover { background-color: var(--danger-dark); }
.btn-submit { background-color: var(--primary); color:white; padding:15px 25px; border:none; border-radius:8px; font-size:18px; cursor:pointer; width:100%; transition: var(--transition); font-weight:600; display:flex; align-items:center; justify-content:center; gap:10px; }
.btn-submit:hover { background-color: var(--primary-dark); transform:translateY(-2px); box-shadow:0 6px 12px rgba(0,0,0,0.15); }
.btn-submit:active { transform:translateY(0); }
.status-message { text-align:center; margin-top:20px; padding:15px; border-radius:8px; font-weight:500; }
.success { background-color: rgba(76,175,80,0.1); color:#2e7d32; border:1px solid #4caf50; }
.error { background-color: rgba(232,17,35,0.1); color:#c62828; border:1px solid var(--danger); }
.id-error { color: var(--danger); font-size:14px; margin-top:5px; display:flex; align-items:center; gap:5px; }
.readonly-field { background-color:#f8f9fa; color: var(--gray); }
.section-title { font-size:1.4rem; color: var(--primary); margin-bottom:20px; padding-bottom:10px; border-bottom:2px solid var(--primary-light); }
/* Footer */
.footer { background-color: var(--primary); color:white; text-align:center; padding:20px; margin-top:40px; }
@media (max-width:768px){.nav-container{flex-direction:column;gap:15px}.header{flex-direction:column;text-align:center}.header img{margin-right:0;margin-bottom:10px}.form-grid{grid-template-columns:1fr}.form-container{padding:20px}}
@media (max-width:480px){.container{padding:0 10px}.header h2{font-size:1.5rem}fieldset{padding:15px}.nav-buttons{flex-direction:column;width:100%}.nav-btn{width:100%;justify-content:center}}
</style>
</head>
<body>
<header class="nav-header">
  <div class="nav-container">
    <div class="nav-logo">
      <img src="https://provincialgovernment.co.za/img/logos/thumb_7_agriculture%2C_environmental_affairs%2C_rural_development_and_land_reform.png" alt="CASP Logo">
      <h1>CASP Farmer Portal</h1>
    </div>
    <div class="nav-buttons">
      <button class="nav-btn" id="homeBtn"><i class="fas fa-home"></i> Home</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="header">
    <img src="https://provincialgovernment.co.za/img/logos/thumb_7_agriculture%2C_environmental_affairs%2C_rural_development_and_land_reform.png" alt="CASP Logo">
    <h2>CASP Farmer & Household Profile Form</h2>
  </div>
  <div class="form-container">
    <form id="profileForm">
      <fieldset>
        <legend><i class="fas fa-user-circle"></i> Profile Picture</legend>
        <div class="profile-pic-container">
          <img id="preview" class="profile-pic" alt="Profile Preview">
          <div class="photo-actions">
            <div class="file-input-wrapper">
              <div class="file-input-button"><i class="fas fa-camera"></i> Upload Profile Picture</div>
              <input type="file" id="profilePic" accept="image/*">
            </div>
            <button type="button" class="btn-remove" onclick="removePhoto()"><i class="fas fa-trash"></i> Remove Picture</button>
          </div>
        </div>
      </fieldset>
      <!-- Household and Agricultural Information ... (keep all your existing fields) -->
      <button type="submit" class="btn-submit"><i class="fas fa-paper-plane"></i> Submit Profile</button>
      <div id="statusMsg" class="status-message"></div>
    </form>
  </div>
</div>

<footer class="footer">
  <p>&copy; 2025/26 CASP Farmer Portal. All rights reserved.</p>
</footer>

<script>
// Profile Picture Preview
const profilePicInput = document.getElementById('profilePic');
const preview = document.getElementById('preview');
let base64Image = "";
profilePicInput.addEventListener('change', function(event){
  const file = event.target.files[0];
  if(file){
    if(!file.type.match('image.*')){
      showStatusMessage('Please select a valid image file.', 'error'); return;
    }
    if(file.size > 5*1024*1024){ showStatusMessage('Image size should be less than 5MB.', 'error'); return; }
    const reader = new FileReader();
    reader.onload = function(e){
      base64Image = e.target.result;
      preview.src = base64Image;
      preview.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
});
function removePhoto(){
  profilePicInput.value = "";
  base64Image = "";
  preview.src = "";
  preview.style.display = "none";
}

// Navigation
document.getElementById('homeBtn').addEventListener('click', function(){ 
  window.location.href = 'https://daerlhelpdesk.github.io/CASP/index.html';
});

// ID Validation
const idInput = document.getElementById('idNumber');
const idError = document.getElementById('idError');
const birthDateInput = document.getElementById('birthDate');
const ageInput = document.getElementById('age');
idInput.addEventListener('input', () => {
  const id = idInput.value.trim();
  idError.innerHTML = "";
  if(id.length===13 && /^\d+$/.test(id)){
    const year = parseInt(id.substring(0,2));
    const month = parseInt(id.substring(2,4));
    const day = parseInt(id.substring(4,6));
    const currentYear = new Date().getFullYear()%100;
    const fullYear = year<=currentYear?2000+year:1900+year;
    const birthDate = new Date(fullYear, month-1, day);
    if(birthDate.getMonth()+1!==month || birthDate.getDate()!==day){
      idError.innerHTML='<i class="fas fa-exclamation-triangle"></i> Invalid ID date format.';
      birthDateInput.value=""; ageInput.value=""; return;
    }
    let age = new Date().getFullYear()-birthDate.getFullYear();
    const m = new Date().getMonth()-birthDate.getMonth();
    if(m<0 || (m===0 && new Date().getDate()<birthDate.getDate())) age--;
    if(age<18){ idError.innerHTML='<i class="fas fa-exclamation-triangle"></i> Must be at least 18 years old.'; birthDateInput.value=""; ageInput.value=""; return; }
    birthDateInput.value = birthDate.toLocaleDateString('en-ZA',{year:'numeric',month:'long',day:'numeric'});
    ageInput.value = age;
    idError.innerHTML='<i class="fas fa-check-circle"></i> Valid ID number.'; idError.style.color='#4caf50';
  } else if(id.length>0 && id.length<13){ idError.innerHTML='<i class="fas fa-exclamation-triangle"></i> ID must be 13 digits.'; idError.style.color='#e81123'; birthDateInput.value=""; ageInput.value=""; }
});

// Status message
function showStatusMessage(message,type){
  const statusMsg = document.getElementById('statusMsg');
  statusMsg.textContent = message;
  statusMsg.className='status-message '+type;
}

// Form Submission
document.getElementById('profileForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const requiredFields = document.querySelectorAll('[required]');
  let isValid = true;
  requiredFields.forEach(f => { if(!f.value.trim()){ isValid=false; f.style.borderColor='#e81123';} else {f.style.borderColor='#ddd';}});
  if(!isValid){ showStatusMessage('Please fill in all required fields.','error'); return;}
  if(idError.textContent!=="" && !idError.textContent.includes('Valid ID number')){ showStatusMessage('Please fix the ID number before submitting.','error'); return;}
  showStatusMessage('Submitting...','success');
  // Prepare data for submission
  const formData = { 
    IDNumber:idInput.value,
    ProfilePicture:base64Image
    // add other fields here
  };
  try{
    const response = await fetch("YOUR_POWER_AUTOMATE_URL",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(formData)
    });
    if(response.ok){
      showStatusMessage('Profile submitted successfully!','success');
      document.getElementById('profileForm').reset();
      removePhoto();
      idError.innerHTML=''; idError.style.color='';
    } else { showStatusMessage('Submission failed. Please try again.','error'); }
  }catch(err){ showStatusMessage('Network error: '+err.message,'error'); }
});
</script>
</body>
</html>
